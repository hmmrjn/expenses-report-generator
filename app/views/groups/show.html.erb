<p id="notice"><%= notice %></p>

<h1><%= link_to 'Groups', groups_path %> ï¼ž <%= @group.name %></h1>

<br>

<ul class="list-group">
  <% @group.sub_groups.each do |sub_group| %>

    <li class="list-group-item list-group-item-action d-flex justify-content-between p-0">
      <%= link_to sub_group.name, sub_group, class: 'flex-grow-1 text-dark p-3' %>
      <span>
        <%= link_to edit_group_path(sub_group), title: 'Rename', class: 'd-inline-block text-dark m-3' do %>
          <i class="fas fa-edit px-2"></i>
        <% end %>
        <%= link_to sub_group, title: 'Destroy', method: :delete, data: { confirm: 'Are you sure? All expenses in this group will be deleted.' }, class: 'd-inline-block text-danger m-3' do %>
          <i class="fas fa-trash px-2"></i>
        <% end %>
      </span>
    </li>
  <% end %>
</ul>

<br>

<%= link_to new_sub_group_path, class: 'btn btn-primary' do %>
<i class="fas fa-plus mr-1"></i> New Sub Group
<% end %>

<br>
<br>

<h2>Expenses in Sub Groups of this Group</h2>

<%= link_to 'Download', "/groups/#{@group.id}/download_excel", class: 'btn btn-primary' %>

<table class="expenses-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Category</th>
      <th>Sub category</th>
      <th>Amount</th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @expenses.each do |expense| %>
      <tr>
        <td><%= expense.date %></td>
        <td><%= expense.sub_category.category.name.upcase %></td>
        <td><%= expense.sub_category.name.capitalize %></td>
        <td align="right"><%= expense.amount.to_s(:delimited) %></td>
        <td><%= link_to edit_expense_path(expense), title: 'Edit' do %><i class="fas fa-edit"></i><% end %></td>
        <td><%= link_to expense, title: 'Delete', method: :delete, data: { confirm: 'Are you sure?' } do %><i class="fas fa-trash"></i><% end %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<br>

<h2>Sums of each Sub Category</h2>

<%= link_to 'Download', "/groups/#{@group.id}/download_sums_excel", class: 'btn btn-primary' %>

<table class="expenses-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Category</th>
      <th>Sub category</th>
      <th>Amount</th>
    </tr>
  </thead>
  <tbody>
    <% @sub_categories.each do |sub_category| %>
      <tr>
        <td><%= sub_category.date_span(@group.id) %></td>
        <td><%= sub_category.category.name.upcase %></td>
        <td><%= sub_category.name.titleize %></td>
        <td><%= sub_category.expenses.where(sub_group: @sub_groups).sum(:amount).to_s(:delimited) %></td>
      </tr>
    <% end %>
  </tbody>
</table>
