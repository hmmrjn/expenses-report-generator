<p id="notice"><%= notice %></p>

<h1><%= @group.name %></h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @group.sub_groups.each do |sub_group| %>
      <tr>
        <td><%= link_to sub_group.name, sub_group %></td>
        <td><%= link_to 'Edit', edit_sub_group_path(sub_group) %></td>
        <td><%= link_to 'Destroy', sub_group, method: :delete, data: { confirm: 'Are you sure? All expenses in this group will be deleted.' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Sub Group', new_sub_group_path(group_id: @group.id) %>

<br>
<br>

<%= link_to 'Rename', edit_group_path(@group) %> |
<%= link_to 'Back', groups_path %>

<br>
<br>
<h2>Expenses in Sub Groups of this Group</h2>

<table class="expenses-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Category</th>
      <th>Sub category</th>
      <th>Amount</th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @expenses.each do |expense| %>
      <tr>
        <td><%= expense.date %></td>
        <td><%= expense.sub_category.category.name.upcase %></td>
        <td><%= expense.sub_category.name.capitalize %></td>
        <td align="right"><%= expense.amount.to_s(:delimited) %></td>
        <td><%= link_to edit_expense_path(expense), title: 'Edit' do %><i class="fas fa-edit"></i><% end %></td>
        <td><%= link_to expense, title: 'Delete', method: :delete, data: { confirm: 'Are you sure?' } do %><i class="fas fa-trash"></i><% end %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<br>

<h2>Sums of each Sub Category</h2>
<table class="expenses-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Category</th>
      <th>Sub category</th>
      <th>Amount</th>
    </tr>
  </thead>
  <tbody>
    <% @sub_categories.each do |sub_category| %>
      <tr>
        <td><%= sub_category.date_span(@group.id) %></td>
        <td><%= sub_category.category.name.upcase %></td>
        <td><%= sub_category.name.titleize %></td>
        <td>
          <%= sub_groups = SubGroup.where(group: @group)
          expenses = sub_category.expenses.where(sub_group: @sub_groups)
          expenses.sum(:amount).to_s(:delimited) %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
